<script type="text/babel">
    var Description = React.createClass(
            {
                loadDataFromServer: function() {
                    $.ajax(
                            {
                                url: this.props.url + '/' + this.props.dataId ,
                                dataType: 'json',
                                cache: false,
                                success: function(data) {
                                    this.setState(
                                            {
                                                data: data
                                            }
                                    );
                                }.bind(this),
                                error: function(xhr, status, err) {
                                    console.error(this.props.url, status, err.toString());
                                }.bind(this)
                            }
                    );
                },
                getInitialState: function() {
                    return {
                        data: {
                        }
                    };
                },
                componentDidMount: function() {
                    this.loadDataFromServer();
                    setInterval(this.loadDataFromServer, this.props.pollInterval);
                },
                render: function() {
                    var description = this.state.data
                    var parameterList = JSON.stringify(description.parameter_list)

                    return (
                        <div className="description span6">
                            <h2>Strategy Description</h2>
                            <table className="table table-hover table-condensed">
                                <tbody>
                                    <tr>
                                        <th>Name</th>
                                        <td>{description.name}</td>
                                    </tr>
                                    <tr>
                                        <th>Parameter list</th>
                                        <td>{parameterList}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    );
                }
            }
    );
    var Statistic = React.createClass(
            {
                loadDataFromServer: function() {
                    $.ajax(
                            {
                                url: this.props.url + '/' + this.props.dataId ,
                                dataType: 'json',
                                cache: false,
                                success: function(data) {
                                    this.setState(
                                            {
                                                data: data
                                            }
                                    );
                                }.bind(this),
                                error: function(xhr, status, err) {
                                    console.error(this.props.url, status, err.toString());
                                }.bind(this)
                            }
                    );
                },
                getInitialState: function() {
                    return {
                        data: {
                        }
                    };
                },
                componentDidMount: function() {
                    this.loadDataFromServer();
                    setInterval(this.loadDataFromServer, this.props.pollInterval);
                },
                render: function() {
                    var statistic = this.state.data

                    return (
                            <div className="statistic span6">
                                <h2>Strategy Statistic</h2>
                                <table className="table table-hover table-condensed">
                                    <tbody>
                                        <tr>
                                        <th>Profit</th>
                                        <td>{statistic.profit}</td>
                                        </tr>
                                        <tr>
                                        <th>Profitability</th>
                                        <td>{statistic.profitability}</td>
                                        </tr>
                                        <tr>
                                        <th>Trade count</th>
                                        <td>{statistic.trade_count}</td>
                                        </tr>
                                        <tr>
                                        <th>Average loss</th>
                                        <td>{statistic.average_loss}</td>
                                        </tr>
                                        <tr>
                                        <th>Average win</th>
                                        <td>{statistic.average_win}</td>
                                        </tr>
                                        <tr>
                                        <th>Maximum loss</th>
                                        <td>{statistic.maximum_loss}</td>
                                        </tr>
                                        <tr>
                                        <th>Maximum win</th>
                                        <td>{statistic.maximum_win}</td>
                                        </tr>
                                        <tr>
                                        <th>Buy percentage</th>
                                        <td>{statistic.buy_percentage}</td>
                                        </tr>
                                        <tr>
                                        <th>Buy win count</th>
                                        <td>{statistic.buy_win_count}</td>
                                        </tr>
                                        <tr>
                                        <th>Sell win count</th>
                                        <td>{statistic.sell_win_count}</td>
                                        </tr>
                                        <tr>
                                        <th>Average trade length</th>
                                        <td>{statistic.average_trade_length}</td>
                                        </tr>
                                        <tr>
                                        <th>OM count</th>
                                        <td>{statistic.one_minute_trade_count}</td>
                                        </tr>
                                        <tr>
                                        <th>OM profit</th>
                                        <td>{statistic.one_minute_trade_profit}</td>
                                        </tr>
                                        <tr>
                                        <th>OM win percentage</th>
                                        <td>{statistic.one_minute_trade_win_percentage}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                    );
                }
            }
    );
    var Trade = React.createClass(
            {
                render: function() {
                    var trade = this.props.data
                    return (
                        <tr>
                            <td>{trade.type}</td>
                            <td>{trade.opening_state_date_time}</td>
                            <td>{trade.closing_state_date_time}</td>
                            <td>{trade.opening_state_ask_price}</td>
                            <td>{trade.closing_state_ask_price}</td>
                            <td>{trade.opening_state_ask_volume}</td>
                            <td>{trade.closing_state_ask_volume}</td>
                        </tr>
                    );
                }
            }
    );
    var Page = React.createClass(
            {
                render: function() {
                    page = this.props.data
                    return (
                        <li>
                            <a href="{page.url}">{page.page_number}</a>
                        </li>
                    );
                }
            }
    );
    var Pager = React.createClass(
            {
                render: function() {
                    pager = this.props.data

                    var pages = pager.pages.map(
                            function(trade) {
                                return (
                                        <Page data={trade} />
                                );
                            }
                    );

                    return (
                        <div className="pagination pagination-centered">
                            <ul>
                                <li>
                                    <a href="{pager.prev_page_url}" aria-label="Previous">
                                        <span aria-hidden="true">&laquo;</span>
                                    </a>
                                </li>
                                {pages}
                                <li>
                                    <a href="{pager.next_page_url}" aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    );
                }
            }
    );
    var TradeList = React.createClass(
        {
            loadDataFromServer: function() {
                $.ajax(
                        {
                            url: this.props.url + '/' + this.props.dataId + '/trades',
                            dataType: 'json',
                            cache: false,
                            success: function(data) {
                                this.setState(
                                        {
                                            data: data
                                        }
                                );
                            }.bind(this),
                            error: function(xhr, status, err) {
                                console.error(this.props.url, status, err.toString());
                            }.bind(this)
                        }
                );
            },
            getInitialState: function() {
                return {
                    data: {
                        data: []
                    }
                };
            },
            componentDidMount: function() {
                this.loadDataFromServer();
                setInterval(this.loadDataFromServer, this.props.pollInterval);
            },
            render: function() {
                var tradeList = this.state.data.data.map(
                        function(trade) {
                            return (
                                <Trade data={trade} />
                            );
                        }
                );

                var pager = function() {
                    return (
                            <Trade data={this.state.data} />
                    );
                }

                return (
                    <div className="tradeList">
                        <h2>Trade list</h2>
                        <table className="table table-hover table-condensed">
                            <thead>
                                <tr>
                                    <th>Trade type</th>
                                    <th>Opening date</th>
                                    <th>Closing date</th>
                                    <th>Opening price</th>
                                    <th>Closing price</th>
                                    <th>Opening volume</th>
                                    <th>Closing volume</th>
                                </tr>
                            </thead>
                            <tbody>{tradeList}</tbody>
                        </table>
                        {pager}
                    </div>
                );
            }
        }
    );
    var Strategy = React.createClass(
            {
                render: function() {
                    return (
                            <div className="strategy row-fluid">
                                <div className="span12">
                                    <h1>Strategy</h1>
                                    <div class="row-fluid">
                                        <Description dataId={this.props.dataId} url="/strategy_descriptions" pollInterval="2000"/>
                                        <Statistic dataId={this.props.dataId} url="/strategy_statistics" pollInterval="2000"/>
                                    </div>
                                    <TradeList dataId={this.props.dataId} url="/strategies" pollInterval="2000"/>
                                </div>
                            </div>
                    );
                }
            }
    );
    var StrategyList = React.createClass(
            {
                loadDataFromServer: function() {
                    $.ajax(
                            {
                                url: this.props.url,
                                dataType: 'json',
                                cache: false,
                                success: function(data) {
                                    this.setState(
                                        {
                                            data: data
                                        }
                                    );
                                }.bind(this),
                                error: function(xhr, status, err) {
                                    console.error(this.props.url, status, err.toString());
                                }.bind(this)
                            }
                    );
                },
                getInitialState: function() {
                    return {
                        data: {
                            data: []
                        }
                    };
                },
                componentDidMount: function() {
                    this.loadDataFromServer();
                    setInterval(this.loadDataFromServer, this.props.pollInterval);
                },

                render: function() {
                    var strategyList = this.state.data.data.map(
                        function(strategyStatistic) {
                            return (
                                <Strategy dataId={strategyStatistic.id} />
                            );
                        }
                    );

                    return (
                            <div className="strategyList">
                                {strategyList}
                            </div>
                    );
                }
            }
    );
    ReactDOM.render(
        <StrategyList url="/strategy_statistics" pollInterval="2000"/>,
        document.getElementById('content')
    );
</script>